<div class="flex justify-center">
  <div class="w-full m-5">
    <div class="card p-6">
      <form [formGroup]="form" (ngSubmit)="onSubmitOperationForm()">

        <!-- Close button -->
        <div class="flex justify-end mb-4">
          <a href="javascript:;" (click)="closePopup()" class="text-black text-2xl">
            <fa-icon [icon]="faClose"></fa-icon>
          </a>
        </div>

        <!-- Montant -->
        <div class="mb-4">
          <label for="montant" class="block text-sm font-medium">Montant</label>
          <input
            id="montant"
            type="number"
            formControlName="montant"
            class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:ring-secondary focus:border-secondary"
            [class.border-red-500]="!form.get('montant')?.valid && submitted"
          />
          @if (!form.get('montant')?.valid && submitted) {
            <div class="text-sm text-red-600 mt-1">
              Un montant supérieur ou égal 0,01 € est obligatoire.
            </div>
          }
        </div>

        <!-- Date opération -->
        <div class="mb-4">
          <label for="operationDate" class="block text-sm font-medium">Date de l'opération</label>
          <input
            id="operationDate"
            type="date"
            formControlName="operationDate"
            [value]="operationDateForInput"
            (change)="form.get('operationDate')?.setValue($event.target.value)"
            class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:ring-secondary focus:border-secondary"
          />

          @if (!form.get('operationDate')?.valid && submitted) {
            <div class="text-sm text-red-600 mt-1">
              Une date est obligatoire.
            </div>
          }
        </div>

        <!-- Dépense / Entrée -->
        @if (!operation.isTransfert) {
          <div class="mb-4">
            <app-slide-toggle
              formControlName="type"
              [labelLeft]="'Dépense'"
              [labelRight]="'Entrée d\'argent'">
            </app-slide-toggle>
          </div>
        }

        <!-- Catégorie -->
        @if (!operation.isTransfert) {
          <div class="mb-4">
            <label for="categorie" class="block text-sm font-medium">Catégorie</label>
            <select
              id="categorie"
              formControlName="categorie"
              class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:ring-secondary focus:border-secondary"
              [class.border-red-500]="!form.get('categorie')?.valid && submitted"
            >
              @for (categorie of categorieList; track categorie) {
                <option [ngValue]="categorie">{{ categorie }}</option>
              }
            </select>
            @if (!form.get('categorie')?.valid && submitted) {
              <div class="text-sm text-red-600 mt-1">
                Une catégorie de dépense est obligatoire.
              </div>
            }
          </div>
        }

        <!-- Compte -->
        <div class="mb-4">
          <label for="compte" class="block text-sm font-medium">
            {{ operation.isTransfert && addOrEdit !== 'edit' ? 'Compte Débiteur' : 'Compte' }}
          </label>
          <select
            id="compte"
            formControlName="compte"
            class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:ring-secondary focus:border-secondary"
            [class.border-red-500]="!form.get('compte')?.valid && submitted"
          >
            @for (type of groupedCompteTypes; track type) {
              <optgroup [label]="type">
                @for (compte of groupedComptes[type]; track compte) {
                  <option [ngValue]="compte.id">{{ compte.name }}</option>
                }
              </optgroup>
            }
          </select>
          @if (!form.get('compte')?.valid && submitted) {
            <div class="text-sm text-red-600 mt-1">Un compte est obligatoire.</div>
          }
        </div>

        <!-- Compte receveur -->
        @if (operation.isTransfert) {
          <div class="mb-4 block">
            <label for="compteReceveur" class="block text-sm font-medium">Compte Receveur</label>
            <select
              id="compteReceveur"
              formControlName="compteReceveur"
              class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:ring-secondary focus:border-secondary"
            >
              @for (type of groupedCompteTypes; track type) {
                <optgroup [label]="type">
                  @for (compte of groupedComptes[type]; track compte) {
                    <option [ngValue]="compte.id">{{ compte.name }}</option>
                  }
                </optgroup>
              }
            </select>
          </div>
        }

        <!-- Description -->
        <div class="mb-4">
          <label for="description1" class="block text-sm font-medium">Description</label>
          <input
            id="description1"
            formControlName="description1"
            class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:ring-secondary focus:border-secondary"
            [class.border-red-500]="!form.get('description1')?.valid && submitted"
          />
          @if (!form.get('description1')?.valid && submitted) {
            <div class="text-sm text-red-600 mt-1">Une description est obligatoire.</div>
          }
        </div>

        <!-- Transfert entre comptes -->
        @if (addOrEdit != 'edit' && compteList.length >= 2) {
          <div class="mb-4">
            <app-slide-toggle
              formControlName="isTransfert"
              [labelLeft]="'Pas de transfert entre compte'"
              [labelRight]="'Transfert entre 2 comptes internes'"
              (change)="changeTransfert($event)">
            </app-slide-toggle>
          </div>
        }

        <!-- Submit -->
        <div class="flex justify-center mt-6">
          <button type="submit" class="btn-primary w-full">{{ buttonLabel }}</button>
        </div>

      </form>
    </div>
  </div>
</div>
